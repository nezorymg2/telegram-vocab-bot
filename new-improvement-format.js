// –ù–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤
const newImprovementPrompt = `
–¢–´: –≠–∫—Å–ø–µ—Ä—Ç IELTS Writing, —É–ª—É—á—à–∞–µ—à—å —Ç–µ–∫—Å—Ç—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–æ —É—Ä–æ–≤–Ω—è 7.0

–ó–ê–î–ê–ß–ê: –£–ª—É—á—à–∏—Ç—å —Ç–µ–∫—Å—Ç –∏ –¥–∞—Ç—å 5 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–≤–µ—Ç–æ–≤ –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
{
  "improved_text": "—É–ª—É—á—à–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º",
  "writing_advice": [
    {
      "number": "1Ô∏è‚É£",
      "title": "–°–¥–µ–ª–∞–π –ø–æ–∑–∏—Ü–∏—é —á—ë—Ç–∫–æ–π –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∫ –Ω–µ–π –≤ –∫–æ–Ω—Ü–µ",
      "why": "üí¨ –ó–∞—á–µ–º: IELTS –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ —è—Å–Ω–æ —Ç—ã –≤—ã—Ä–∞–∂–∞–µ—à—å –º–Ω–µ–Ω–∏–µ.",
      "how": "üß† –ö–∞–∫: –≤–æ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –ø–∏—à–∏ —Ñ—Ä–∞–∑—É, –ø–æ–∫–∞–∑—ã–≤–∞—é—â—É—é —Ç–≤–æ—é –ø–æ–∑–∏—Ü–∏—é (I strongly believe / I personally prefer / I am convinced that‚Ä¶).",
      "example_bad": "—Ü–∏—Ç–∞—Ç–∞ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
      "example_good": "–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —ç—Ç–æ–π –∂–µ —Ü–∏—Ç–∞—Ç—ã", 
      "action": "ü™Ñ –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –Ω–∞—á–Ω–∏ –ø–µ—Ä–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–∑–∏—Ü–∏–∏, –∏ –ø–æ–≤—Ç–æ—Ä–∏ –µ—ë –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–µ –∑–∞–∫–ª—é—á–µ–Ω–∏—è –¥—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏."
    },
    {
      "number": "2Ô∏è‚É£", 
      "title": "–†–∞–∑–¥–µ–ª—è–π —Ç–µ–∫—Å—Ç –Ω–∞ 3 –±–ª–æ–∫–∞: –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ ‚Äî –∞—Ä–≥—É–º–µ–Ω—Ç—ã ‚Äî –≤—ã–≤–æ–¥",
      "why": "üí¨ –ó–∞—á–µ–º: –≠–∫–∑–∞–º–µ–Ω–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É (Coherence & Cohesion).",
      "how": "üß† –ö–∞–∫:\\n\\n–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ ‚Üí –∏–¥–µ—è + –º–Ω–µ–Ω–∏–µ.\\n\\n–û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å ‚Üí 2 –ø—Ä–∏—á–∏–Ω—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏.\\n\\n–ó–∞–∫–ª—é—á–µ–Ω–∏–µ ‚Üí –æ–±–æ–±—â–µ–Ω–∏–µ –∏ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –º—ã—Å–ª—å.",
      "example_bad": "—Ü–∏—Ç–∞—Ç–∞ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
      "example_good": "–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —ç—Ç–æ–π –∂–µ —Ü–∏—Ç–∞—Ç—ã",
      "action": "ü™Ñ –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å —á–µ—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É —á–∞—Å—Ç—è–º–∏ —Ç–µ–∫—Å—Ç–∞."
    },
    {
      "number": "3Ô∏è‚É£",
      "title": "–î–æ–±–∞–≤–ª—è–π —Å–≤—è–∑–∫–∏, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç \\"—Ç—ë–∫\\" –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ",
      "why": "üí¨ –ó–∞—á–µ–º: –ë–µ–∑ —Å–≤—è–∑–æ–∫ —Ç–µ–∫—Å—Ç –∫–∞–∂–µ—Ç—Å—è \\"–∫—É—Å–æ—á–Ω—ã–º\\".",  
      "how": "üß† –ö–∞–∫: –ò—Å–ø–æ–ª—å–∑—É–π —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã:\\n\\n–£—Å—Ç—É–ø–∫–∞: Although, Even though\\n\\n–ü—Ä–æ—Ç–∏–≤–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ: However, On the other hand\\n\\n–ü—Ä–∏—á–∏–Ω–∞/—Å–ª–µ–¥—Å—Ç–≤–∏–µ: Because, As a result, Therefore\\n\\n–í—Ä–µ–º—è: When, After, Before",
      "example_bad": "—Ü–∏—Ç–∞—Ç–∞ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
      "example_good": "–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —ç—Ç–æ–π –∂–µ —Ü–∏—Ç–∞—Ç—ã",
      "action": "ü™Ñ –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –Ω–∞–π–¥–∏ –º–µ—Å—Ç–∞, –≥–¥–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å linking words."
    },
    {
      "number": "4Ô∏è‚É£",
      "title": "–£–∫—Ä–µ–ø–ª—è–π —Å–ª–æ–≤–∞—Ä—å ‚Äî 3 –Ω–æ–≤—ã—Ö —Å–ª–æ–≤–∞ –ø–æ —Ç–µ–º–µ",
      "why": "üí¨ –ó–∞—á–µ–º: Lexical Resource –¥–∞—ë—Ç +0.5‚Äì1 –±–∞–ª–ª.",
      "how": "üß† –ö–∞–∫: –≤—ã–±–∏—Ä–∞–π —Å–∏–Ω–æ–Ω–∏–º—ã –∏ —É—Å—Ç–æ–π—á–∏–≤—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –ø–æ —Ç–µ–º–µ.",
      "example_bad": "—Ü–∏—Ç–∞—Ç–∞ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
      "example_good": "–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —ç—Ç–æ–π –∂–µ —Ü–∏—Ç–∞—Ç—ã",
      "action": "ü™Ñ –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤—ã–ø–∏—Å—ã–≤–∞–π 3 –Ω–æ–≤—ã—Ö —Å–ª–æ–≤–∞ –∏ –ø–æ–ø—Ä–æ–±—É–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –≤ —Å–ª–µ–¥—É—é—â–µ–º."
    },
    {
      "number": "5Ô∏è‚É£",
      "title": "–î–æ–±–∞–≤—å \\"–≥–∏–±–∫—É—é –≥—Ä–∞–º–º–∞—Ç–∏–∫—É\\" ‚Äî —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–ª–æ–∂–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ",
      "why": "üí¨ –ó–∞—á–µ–º: Grammatical Range = –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∫—Ä–∏—Ç–µ—Ä–∏–π Band 7+.",
      "how": "üß† –ö–∞–∫:\\n\\n–ò—Å–ø–æ–ª—å–∑—É–π Although / While / Because –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.\\n\\n–î–æ–±–∞–≤—å —É—Å–ª–æ–≤–Ω–æ–µ –∏–ª–∏ –ø—Ä–∏—á–∞—Å—Ç–Ω–æ–µ:\\nIf I go to bed early, I can't focus well.\\nFeeling tired, I prefer working at night.",
      "example_bad": "—Ü–∏—Ç–∞—Ç–∞ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", 
      "example_good": "–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —ç—Ç–æ–π –∂–µ —Ü–∏—Ç–∞—Ç—ã",
      "action": "ü™Ñ –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –Ω–∞–π–¥–∏ –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏ –æ–±—ä–µ–¥–∏–Ω–∏ –∏—Ö –≤ —Å–ª–æ–∂–Ω—ã–µ."
    }
  ],
  "vocabulary_words": [
    {
      "word": "—Å–ª–æ–≤–æ",
      "translation": "–ø–µ—Ä–µ–≤–æ–¥", 
      "example": "–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å —ç—Ç–∏–º —Å–ª–æ–≤–æ–º –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º"
    }
  ]
}

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
- –í—Å–µ –ø—Ä–∏–º–µ—Ä—ã example_bad –∏ example_good –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ò–ó –†–ï–ê–õ–¨–ù–û–ì–û –¢–ï–ö–°–¢–ê –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- vocabulary_words - 5 —Å–ª–æ–≤ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç–µ–º–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- improved_text —Ç–æ–ª—å–∫–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- –í–æ–∑–≤—Ä–∞—â–∞–π –¢–û–õ–¨–ö–û JSON!
`;

// –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
async function newShowImprovedVersion(ctx, session) {
  const improved = session.improvedText;
  
  if (!improved || !improved.improved_text) {
    return;
  }
  
  try {
    // –ß–∞—Å—Ç—å 1: –£–ª—É—á—à–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
    let message1 = `‚ú® <b>–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è (IELTS 7.0 —É—Ä–æ–≤–µ–Ω—å):</b>\n\n`;
    message1 += `<i>${improved.improved_text}</i>`;
    
    await ctx.reply(message1, { parse_mode: 'HTML' });
    
    // –ß–∞—Å—Ç—å 2: –°–æ–≤–µ—Ç—ã –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
    if (improved.writing_advice && improved.writing_advice.length > 0) {
      for (const advice of improved.writing_advice) {
        let adviceMessage = `${advice.number} <b>${advice.title}</b>\n\n`;
        adviceMessage += `${advice.why}\n\n`;
        adviceMessage += `${advice.how}\n\n`;
        adviceMessage += `‚úçÔ∏è <b>–ü—Ä–∏–º–µ—Ä:</b>\n`;
        adviceMessage += `‚ùå ${advice.example_bad}\n`;
        adviceMessage += `‚úÖ ${advice.example_good}\n\n`;
        adviceMessage += `${advice.action}`;
        
        await ctx.reply(adviceMessage, { parse_mode: 'HTML' });
      }
    }
    
    // –ß–∞—Å—Ç—å 3: –°–ª–æ–≤–∞—Ä—å
    if (improved.vocabulary_words && improved.vocabulary_words.length > 0) {
      let vocabMessage = `üìö <b>–¢–æ–ø-5 —Å–ª–æ–≤ –¥–ª—è —ç—Ç–æ–π —Ç–µ–º—ã:</b>\n\n`;
      improved.vocabulary_words.forEach((vocab, index) => {
        vocabMessage += `${index + 1}. <b>${vocab.word}</b> - ${vocab.translation}\n`;
        vocabMessage += `   <i>${vocab.example}</i>\n\n`;
      });
      
      await ctx.reply(vocabMessage, { parse_mode: 'HTML' });
    }
    
    // –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
    await ctx.reply('‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω! –ß—Ç–æ –¥–∞–ª—å—à–µ?', { 
      reply_markup: new Keyboard()
        .text('üìù –í—ã–ø–æ–ª–Ω–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è')
        .row()
        .text('‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É')
        .row()
        .oneTime()
        .resized()
    });
    
  } catch (error) {
    console.error('Error in newShowImprovedVersion:', error);
    // Fallback - –ø—Ä–æ—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    await ctx.reply('‚ú® –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –≥–æ—Ç–æ–≤–∞! –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.', {
      reply_markup: new Keyboard()
        .text('‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É')
        .row()
        .oneTime()
        .resized()
    });
  }
}